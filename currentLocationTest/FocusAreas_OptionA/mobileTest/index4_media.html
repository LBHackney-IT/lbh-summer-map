<!doctype html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="initial-scale=1,user-scalable=no,maximum-scale=1,width=device-width">
        <meta name="mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <link rel="stylesheet" href="css/leaflet.css">
        <link rel="stylesheet" href="css/qgis2web.css">
        <link rel="stylesheet" href="css/L.Control.Window.css" />
		<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/leaflet-easybutton@2/src/easy-button.css">
        <style>
        html, body, #map {
            width: 100%;
            height: 100%;
            padding: 0;
            margin: 0;
        }
        </style>
        <title></title>
    </head>
    <body>
        <div id="map">
        </div>
        <script src="js/qgis2web_expressions.js"></script>
        <script src="js/leaflet.js"></script>
        <script src="js/leaflet.rotatedMarker.js"></script>
        <script src="js/leaflet.pattern.js"></script>
        <script src="js/leaflet-hash.js"></script>
        <script src="js/Autolinker.min.js"></script>
        <script src="js/rbush.min.js"></script>
        <script src="js/labelgun.min.js"></script>
        <script src="js/labels.js"></script>
        <script src="js/leaflet.wms.js"></script>
        <script src="data/7mabovegroundlevel_2.js"></script>
        <script src="data/4mabovegroundlevel_3.js"></script>
        <script src="data/15mabovegroundlevel_4.js"></script>
        <script src="js/Leaflet.Control.Custom.js"></script>
        <script src="js/L.Control.Window.js"></script>
		<script src="https://cdn.jsdelivr.net/npm/leaflet-easybutton@2/src/easy-button.js"></script>
        <script defer src="https://use.fontawesome.com/releases/v5.3.1/js/all.js" integrity="sha384-kW+oWsYx3YpxvjtZjFXqazFpA7UP/MbiY4jvs+RWZo2+N94PFZ36T6TFkc9O3qoB" crossorigin="anonymous"></script>
		<script>
        var map = L.map('map', {
            zoomControl:true, maxZoom:20, minZoom:13,
			center: [51.5556, -0.0792],
			zoom: 15
        });
		
		L.control.scale().addTo(map);
		
        // -------------------------------------------------------------------------------------------------------------
        //basemap

        var hash = new L.Hash(map);
        map.attributionControl.addAttribution('<a href="https://github.com/tomchadwin/qgis2web" target="_blank">qgis2web</a>');
        var bounds_group = new L.featureGroup([]);
        function setBounds() {
        }

        // -------------------------------------------------------------------------------------------------------------
        //basemap ZoomStack

        var overlay_OSZoomStack_0 = L.tileLayer('https://api.mapbox.com/styles/v1/hackneygis/cjk8lmw5r9mlz2sohv2n6xnfq/tiles/256/{z}/{x}/{y}?access_token=pk.eyJ1IjoiaGFja25leWdpcyIsImEiOiJjajh2ZGRiMDMxMzc5MndwbHBmaGtjYTAyIn0.G75YwN8Zgr8gqDJoV8XMFw', {
            opacity: 1.0,
            maxZoom: 17,
        });
        overlay_OSZoomStack_0.addTo(map);

        // -------------------------------------------------------------------------------------------------------------
        //basemap MasterMap

        map.addLayer(overlay_OSZoomStack_0);
        var overlay_OSMM_light_1 = L.WMS.layer("http://lbhgiswebt01/geoserver/wms", "osmm:OSMM_light", {
            format: 'image/png',
            uppercase: true,
            transparent: true,
            continuousWorld : true,
            tiled: true,
            info_format: 'text/html',
            opacity: 1,
            identify: false,
            minZoom: 18,
            maxZoom: 20,
        });

        map.addLayer(overlay_OSMM_light_1);

        // -------------------------------------------------------------------------------------------------------------
        // disclaimer

		var disclaimerContent = "Please confirm that you have read the explanatory text that accompanies these maps. Additional modelling for William Patten School is shown within the <a href=''>Annual Average NO2 - William Patten School map </a> and should be referred to for the school site. Full details of the modelling undertaken are provided with CERC\'s Air Quality Assessment of Walford Road Scheme Phase 1 dated 16th August 2018.";
		
        var winOpts = L.control.window(map,
            {content: disclaimerContent,
            visible: true,
            position: 'top',
            closeButton: false,
            modal: true,
            prompt: {
                //callback: function(){alert('OK clicked')}, 
                //action: function(){alert('action clicked')},
                //buttonAction: 'action', 
                buttonOK: 'OK',
                //buttonCancel: 'Cancel'
            } 
        });
		
		/*
		var disclaimerButton = L.easyButton('&quest;', function(btn, map){
			alert(disclaimerContent);
		},{position:'topright'});

		disclaimerButton.addTo(map);
		*/
	

        // -------------------------------------------------------------------------------------------------------------
        // styles and popups - 7 m above ground level layer

        function pop_7mabovegroundlevel_2(feature, layer) {
            var popupContent = '<table>\
                    <tr>\
                        <td colspan="2"><strong>Annual average NO2 - <br> 7 m above ground-level </strong><br/>' + (feature.properties['label'] !== null ? Autolinker.link(String(feature.properties['label'])) : '') + " µg/m³" + '</td>\
                    </tr>\
                </table>';
            layer.bindPopup(popupContent, {maxHeight: 400});
        }

        function style_7mabovegroundlevel_2_0(feature) {
            switch(String(feature.properties['label'])) {
                case '<32':
                    return {
                pane: 'pane_7mabovegroundlevel_2',
                stroke: false, 
                fill: true,
                fillOpacity: 1,
                fillColor: 'rgba(0,112,255,0.5)',
            }
                    break;
                case '32-36':
                    return {
                pane: 'pane_7mabovegroundlevel_2',
                stroke: false, 
                fill: true,
                fillOpacity: 1,
                fillColor: 'rgba(176,208,255,0.5)',
            }
                    break;
                case '36-40':
                    return {
                pane: 'pane_7mabovegroundlevel_2',
                stroke: false, 
                fill: true,
                fillOpacity: 1,
                fillColor: 'rgba(176,255,176,0.5)',
            }
                    break;
                case '40-44':
                    return {
                pane: 'pane_7mabovegroundlevel_2',
                stroke: false, 
                fill: true,
                fillOpacity: 1,
                fillColor: 'rgba(255,255,0,0.5)',
            }
                    break;
                case '44-48':
                    return {
                pane: 'pane_7mabovegroundlevel_2',
                stroke: false, 
                fill: true,
                fillOpacity: 1,
                fillColor: 'rgba(230,152,0,0.5)',
            }
                    break;
                case '48-60':
                    return {
                pane: 'pane_7mabovegroundlevel_2',
                stroke: false, 
                fill: true,
                fillOpacity: 1,
                fillColor: 'rgba(255,0,0,0.5)',
            }
                    break;
                case '>60':
                    return {
                pane: 'pane_7mabovegroundlevel_2',
                stroke: false, 
                fill: true,
                fillOpacity: 1,
                fillColor: 'rgba(168,0,0,0.5)',
            }
                    break;
            }
        }
        map.createPane('pane_7mabovegroundlevel_2');
        map.getPane('pane_7mabovegroundlevel_2').style.zIndex = 402;
        map.getPane('pane_7mabovegroundlevel_2').style['mix-blend-mode'] = 'normal';
        var layer_7mabovegroundlevel_2 = new L.geoJson(json_7mabovegroundlevel_2, {
            attribution: '<a href=""></a>',
            pane: 'pane_7mabovegroundlevel_2',
            onEachFeature: pop_7mabovegroundlevel_2,
            style: style_7mabovegroundlevel_2_0,
        });
        bounds_group.addLayer(layer_7mabovegroundlevel_2);
       

        // -------------------------------------------------------------------------------------------------------------
         // styles and popups - 4 m above ground level layer

        function pop_4mabovegroundlevel_3(feature, layer) {
            var popupContent = '<table>\
                    <tr>\
                        <td colspan="2"><strong>Annual average NO2 - <br> 4 m above ground-level </strong><br />' + (feature.properties['label'] !== null ? Autolinker.link(String(feature.properties['label'])) : '') + " µg/m³" + '</td>\
                    </tr>\
                </table>';
            layer.bindPopup(popupContent, {maxHeight: 400});
        }

        function style_4mabovegroundlevel_3_0(feature) {
            switch(String(feature.properties['label'])) {
                case '<32':
                    return {
                pane: 'pane_4mabovegroundlevel_3',
                stroke: false, 
                fill: true,
                fillOpacity: 1,
                fillColor: 'rgba(0,112,255,0.5)',
            }
                    break;
                case '32-36':
                    return {
                pane: 'pane_4mabovegroundlevel_3',
                stroke: false, 
                fill: true,
                fillOpacity: 1,
                fillColor: 'rgba(176,208,255,0.5)',
            }
                    break;
                case '36-40':
                    return {
                pane: 'pane_4mabovegroundlevel_3',
                stroke: false, 
                fill: true,
                fillOpacity: 1,
                fillColor: 'rgba(176,255,176,0.5)',
            }
                    break;
                case '40-44':
                    return {
                pane: 'pane_4mabovegroundlevel_3',
                stroke: false, 
                fill: true,
                fillOpacity: 1,
                fillColor: 'rgba(255,255,0,0.5)',
            }
                    break;
                case '44-48':
                    return {
                pane: 'pane_4mabovegroundlevel_3',
                stroke: false, 
                fill: true,
                fillOpacity: 1,
                fillColor: 'rgba(230,152,0,0.5)',
            }
                    break;
                case '48-60':
                    return {
                pane: 'pane_4mabovegroundlevel_3',
                stroke: false, 
                fill: true,
                fillOpacity: 1,
                fillColor: 'rgba(255,0,0,0.5)',
            }
                    break;
                case '>60':
                    return {
                pane: 'pane_4mabovegroundlevel_3',
                stroke: false, 
                fill: true,
                fillOpacity: 1,
                fillColor: 'rgba(168,0,0,0.5)',
            }
                    break;
            }
        }
        map.createPane('pane_4mabovegroundlevel_3');
        map.getPane('pane_4mabovegroundlevel_3').style.zIndex = 403;
        map.getPane('pane_4mabovegroundlevel_3').style['mix-blend-mode'] = 'normal';
        var layer_4mabovegroundlevel_3 = new L.geoJson(json_4mabovegroundlevel_3, {
            attribution: '<a href=""></a>',
            pane: 'pane_4mabovegroundlevel_3',
            onEachFeature: pop_4mabovegroundlevel_3,
            style: style_4mabovegroundlevel_3_0,
        });
        bounds_group.addLayer(layer_4mabovegroundlevel_3);
        

        // -------------------------------------------------------------------------------------------------------------
        // styles and popups - 1.5 m above ground level layer

        function pop_15mabovegroundlevel_4(feature, layer) {
            var popupContent = '<table>\
                    <tr>\
                        <td colspan="2"><strong>Annual average NO2 - <br> 1.5 m above ground-level </strong><br />' + (feature.properties['label'] !== null ? Autolinker.link(String(feature.properties['label'])) : '') + " µg/m³" + '</td>\
                    </tr>\
                </table>';
            layer.bindPopup(popupContent, {maxHeight: 400});
        }

        function style_15mabovegroundlevel_4_0(feature) {
            switch(String(feature.properties['label'])) {
                case '<32':
                    return {
                pane: 'pane_15mabovegroundlevel_4',
                stroke: false, 
                fill: true,
                fillOpacity: 1,
                fillColor: 'rgba(0,112,255,0.5)',
            }
                    break;
                case '32-36':
                    return {
                pane: 'pane_15mabovegroundlevel_4',
                stroke: false, 
                fill: true,
                fillOpacity: 1,
                fillColor: 'rgba(176,208,255,0.5)',
            }
                    break;
                case '36-40':
                    return {
                pane: 'pane_15mabovegroundlevel_4',
                stroke: false, 
                fill: true,
                fillOpacity: 1,
                fillColor: 'rgba(176,255,176,0.5)',
            }
                    break;
                case '40-44':
                    return {
                pane: 'pane_15mabovegroundlevel_4',
                stroke: false, 
                fill: true,
                fillOpacity: 1,
                fillColor: 'rgba(255,255,0,0.5)',
            }
                    break;
                case '44-48':
                    return {
                pane: 'pane_15mabovegroundlevel_4',
                stroke: false, 
                fill: true,
                fillOpacity: 1,
                fillColor: 'rgba(230,152,0,0.5)',
            }
                    break;
                case '48-60':
                    return {
                pane: 'pane_15mabovegroundlevel_4',
                stroke: false, 
                fill: true,
                fillOpacity: 1,
                fillColor: 'rgba(255,0,0,0.5)',
            }
                    break;
                case '>60':
                    return {
                pane: 'pane_15mabovegroundlevel_4',
                stroke: false, 
                fill: true,
                fillOpacity: 1,
                fillColor: 'rgba(168,0,0,0.5)',
            }
                    break;
            }
        }
        map.createPane('pane_15mabovegroundlevel_4');
        map.getPane('pane_15mabovegroundlevel_4').style.zIndex = 404;
        map.getPane('pane_15mabovegroundlevel_4').style['mix-blend-mode'] = 'normal';
        var layer_15mabovegroundlevel_4 = new L.geoJson(json_15mabovegroundlevel_4, {
            attribution: '<a href=""></a>',
            pane: 'pane_15mabovegroundlevel_4',
            onEachFeature: pop_15mabovegroundlevel_4,
            style: style_15mabovegroundlevel_4_0,
        });
        bounds_group.addLayer(layer_15mabovegroundlevel_4);
        map.addLayer(layer_15mabovegroundlevel_4);

			
		// -------------------------------------------------------------------------------------------------------------
        // layer control
		
		var baseMaps = {};
        var layerControl = L.control.layers(baseMaps,{'1.5 m above ground-level<br /><table><tr><td></td></tr></table>': layer_15mabovegroundlevel_4,' 4 m above ground-level<br /><table><tr><td></td></tr></table>': layer_4mabovegroundlevel_3,' 7 m above ground-level<br /><table><tr><td></td></tr></table>': layer_7mabovegroundlevel_2,}).addTo(map);
		//if (L.Browser.mobile != false) {layerControl.options.collapsed = false; layerControl.expand();};
		
		// -------------------------------------------------------------------------------------------------------------
        // static legend

        var legend = L.control.custom({
		id: 'legend',
		position: 'topright',
		collapsed:true,
		content : '<table cellpadding="0"><tr><td><strong>Annual average NO2<br/>around Walford Road</strong></td><td align="right" valign="top"><i class="fas fa-times-circle"></i></td><tr><td colspan="2">Measured at three heights<br/>(also see map for<br/><a href="wpatten.html">William Patten school)</a><br/><br/></td></tr></table><table><tr><td><img src="legend/15mabovegroundlevel_4_320.png" /></td><td><32 µg/m³</td></tr><tr><td><img src="legend/15mabovegroundlevel_4_32361.png" /></td><td>32-36 µg/m³</td></tr><tr><td><img src="legend/15mabovegroundlevel_4_36402.png" /></td><td>36-40 µg/m³</td></tr><tr><td><img src="legend/15mabovegroundlevel_4_40443.png" /></td><td>40-44 µg/m³</td></tr><tr><td><img src="legend/15mabovegroundlevel_4_44484.png" /></td><td>44-48 µg/m³</td></tr><tr><td><img src="legend/15mabovegroundlevel_4_48605.png" /></td><td>48-60 µg/m³</td></tr><tr><td><img src="legend/15mabovegroundlevel_4_606.png" /></td><td>>60 µg/m³</td></tr></table>',
		classes : 'leaflet-control-layers',
		style   :{
			margin: '10px',
			padding: '10px 17px 10px 17px'
		},
		events:{
			click: function(data){
				map.removeControl(legend);
				//map.removeControl(layerControl);
				toggleLegend.addTo(map);
				//layerControl.addTo(map);
        }
		}
		})
		//.addTo(map);
		
		//var toggleLegend = L.easyButton('&Lscr;', function(btn, map){
		//	alert(disclaimerContent);
		//},{position:'topright'});
		
		var toggleLegend = L.easyButton({
			position: 'topright',
			states: [{
				stateName: 'legend-on',
				icon: 'fa-info-circle',
				title: 'view info/legend',
				onClick: function(control) {
					//map.removeControl(layerControl);
					legend.addTo(map);
					map.removeControl(toggleLegend);
					//layerControl.addTo(map);
				//control.state('legend-off');
				}
			}, {
				stateName: 'legend-off',
				icon: 'fa-times-circle',
				onClick: function(control) {
					map.removeControl(legend);
				control.state('legend-on');
				},
				title: 'hide info/legend'
			}]
		});

		toggleLegend.addTo(map);

		// -------------------------------------------------------------------------------------------------------------
        // school marker and popup
		
		var marker = L.marker([51.561774, -0.074887], {
		}).addTo(map);
		marker.bindPopup('See map for<br/><a href="wpatten.html">William Patten school</a>')
		marker.bindTooltip('William Patten school')
		
		// -------------------------------------------------------------------------------------------------------------
       
        //setBounds();

        @media all and (max-width: 900px) {

        if (document.documentElement.clientWidth < 900) {
            layerControl.options.collapsed = true;
            }
        }
    });

        </script>
    </body>
</html>
